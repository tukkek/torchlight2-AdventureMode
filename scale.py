#!/usr/bin/python3
# scales vanilla maps (eg. phase-beast portals)
import generate,dataclasses,os

class ClearLevel(generate.Replace):
  def __init__(self):
    self.pattern='<INTEGER>LEVEL:'
    self.replacement=''
    
@dataclasses.dataclass
class Dungeon:
  display:str
  name:str
    
dungeons=[Dungeon("Shadowy Crevasse","a2z1_cursedfear_desertcaves"),Dungeon("Lair of the Sisters","a3-3sisters"),Dungeon("The Emberworks","a3-banepits"),Dungeon("Sundered Battlefield","a3-battlefield"),Dungeon("Middenmine","a3-middenmine"),Dungeon("Fungal Caves","a3-muckery"),Dungeon("Elemental Oasis","a3-oasis"),Dungeon("The Scrapworks","a3-scrapworks"),Dungeon("The Warforge","a3-warforge"),Dungeon("The Blightbogs","a3blightbogs"),Dungeon("The Rotted Path","a3pass1"),Dungeon("Rivenskull Gorge","a3pass2"),Dungeon("Notch's Mine","a3quarrymine"),Dungeon("Reeking Cellar","a3werewolfcellar"),Dungeon("Ancient Vaults of Chaos","a3z2_ancientvaults"),Dungeon("Forgotten Halls","a3z2_forgottenhalls"),Dungeon("Howling Cave","a3_howlingcave"),Dungeon("Rotting Crypt","a3_rottingcrypt"),Dungeon("Alpha Zone","alphazone"),Dungeon("Arena of Slaughter","arenaofslaughter"),Dungeon("The Brood Hive","broodhive"),Dungeon("The Burial Chambers","burialchambers"),Dungeon("Cacklespit's Realm","cacklespitsrealm"),Dungeon("Catacombs","catacombs"),Dungeon("Catacombs","catacombs_frostedhills"),Dungeon("Catacombs","catacombs_honoreddead"),Dungeon("Crows Pass","crowspass"),Dungeon("Widow's Veil","crowspass_spidercave"),Dungeon("Whispering Cave","cultistslair"),Dungeon("The Dead Shoals","deadshoals"),Dungeon("Tarroch's Tomb","desertcatacombs"),Dungeon("Desert Caves","desertcaves"),Dungeon("The Forgotten Lair","dragon"),Dungeon("Vyrax's Tower","dragonkeep"),Dungeon("The Broken Mines","dwarvenlabs"),Dungeon("Echo Pass","echopass"),Dungeon("Editor Dungeon","editordungeon"),Dungeon("Estherian Shrine","estherianshrine"),Dungeon("Frosted Hills","frostedhills"),Dungeon("Caves","generic_caves"),Dungeon("The Emberscratch Mines","goblin_embercaves"),Dungeon("Haunted Quarter","hauntedquarter"),Dungeon("Icedeep Caverns","icedeepcaverns"),Dungeon("Frozen Caves","ice_caves"),Dungeon("Jehannum","jehannum"),Dungeon("Korari Cave","koraricave"),Dungeon("Foul Cave of Shadows","a3_foulcave"),Dungeon("Castle Ruins","castleruins"),Dungeon("The Corrupted Crypt","defiledcrypt"),Dungeon("Defiled Cemetery","map_catacombs_b_66"),Dungeon("Estherian Depths","map_estherian_a"),Dungeon("Frostbitten Caverns","map_icecaves_a"),Dungeon("Netherrealm","nether_a1z1"),Dungeon("Estherian Shrine","testpuzzle"),Dungeon("Luminous Arena","luminousarena"),Dungeon("Tarroch's Rift","manavent"),Dungeon("The Stygian Aerie","manticorelair"),Dungeon("The Mapworks","maproom"),Dungeon("Cursed Catacombs","maproom_catacombs_1"),Dungeon("Defiled Burrow","map_catacombs_2"),Dungeon("Ghastly Vault","map_catacombs_3"),Dungeon("Infernal Necropolis","map_catacombs_a_105"),Dungeon("Cursed Tombs","map_catacombs_a_56"),Dungeon("Cursed Mausoleum","map_catacombs_a_66"),Dungeon("Infernal Catacombs","map_catacombs_a_76"),Dungeon("Infernal Tombs","map_catacombs_a_86"),Dungeon("Infernal Mausoleum","map_catacombs_a_96"),Dungeon("Desecrated Sepulcher","map_catacombs_b_105"),Dungeon("Defiled Graves","map_catacombs_b_56"),Dungeon("Desecrated Burrow","map_catacombs_b_76"),Dungeon("Desecrated Graves","map_catacombs_b_86"),Dungeon("Desecrated Cemetery","map_catacombs_b_96"),Dungeon("Bloody Boneyard","map_catacombs_c_105"),Dungeon("Ghastly Crypt","map_catacombs_c_56"),Dungeon("Ghastly Mortuary","map_catacombs_c_66"),Dungeon("Bloody Vault","map_catacombs_c_76"),Dungeon("Bloody Crypt","map_catacombs_c_86"),Dungeon("Bloody Mortuary","map_catacombs_c_96"),Dungeon("Shadowy Grotto","map_caves_a"),Dungeon("Abyssal Fissure","map_caves_a_105"),Dungeon("Shadowy Pit","map_caves_a_56"),Dungeon("Shadowy Caves","map_caves_a_66"),Dungeon("Abyssal Grotto","map_caves_a_76"),Dungeon("Abyssal Pit","map_caves_a_86"),Dungeon("Abyssal Caves","map_caves_a_96"),Dungeon("Wyvern Keep","map_dragon_a"),Dungeon("Dragon Bastion","map_dragon_a105"),Dungeon("Wyvern Stronghold","map_dragon_a56-65"),Dungeon("Wyvern Citadel","map_dragon_a66-75"),Dungeon("Dragon Keep","map_dragon_a76-85"),Dungeon("Dragon Stronghold","map_dragon_a86-95"),Dungeon("Dragon Citadel","map_dragon_a96-105"),Dungeon("Forgotten Labs","map_dwarvenlabs_a"),Dungeon("Deserted Foundry","map_dwarvenlabs_a_105"),Dungeon("Forgotten Workshop","map_dwarvenlabs_a_56"),Dungeon("Forgotten Factory","map_dwarvenlabs_a_66"),Dungeon("Deserted Labs","map_dwarvenlabs_a_76"),Dungeon("Deserted Workshop","map_dwarvenlabs_a_86"),Dungeon("Deserted Factory","map_dwarvenlabs_a_96"),Dungeon("Ruined Shrine","map_estherian_b"),Dungeon("Desolate Chantry","map_estherian_b105"),Dungeon("Ruined Sanctuary","map_estherian_b56"),Dungeon("Ruined Temple","map_estherian_b66"),Dungeon("Desolate Shrine","map_estherian_b76"),Dungeon("Desolate Sanctuary","map_estherian_b86"),Dungeon("Desolate Temple","map_estherian_b96"),Dungeon("Infected Hollow","map_estherian_c"),Dungeon("Blighted Sanctum","map_estherian_c_105"),Dungeon("Infected Retreat","map_estherian_c_56"),Dungeon("Infected Depths","map_estherian_c_66"),Dungeon("Blighted Hollow","map_estherian_c_76"),Dungeon("Blighted Retreat","map_estherian_c_86"),Dungeon("Blighted Depths","map_estherian_c_96"),Dungeon("Frostshorn Breach","map_icecaves_a_105"),Dungeon("Frostbitten Ravine","map_icecaves_a_56"),Dungeon("Frostbitten Chasm","map_icecaves_a_66"),Dungeon("Frostshorn Caverns","map_icecaves_a_76"),Dungeon("Frostshorn Ravine","map_icecaves_a_86"),Dungeon("Frostshorn Chasm","map_icecaves_a_96"),Dungeon("Ransacked Halls","map_vaults_a"),Dungeon("Ezrohir Treasury","map_vaults_a105"),Dungeon("Ransacked Commons","map_vaults_a56"),Dungeon("Ransacked Vault","map_vaults_a66"),Dungeon("Ezrohir Halls","map_vaults_a76"),Dungeon("Ezrohir Commons","map_vaults_a86"),Dungeon("Ezrohir Vault","map_vaults_a96"),Dungeon("Nack","nack"),Dungeon("Netherrealm","nether"),Dungeon("Netherrealm","nether_a1z2"),Dungeon("Netherrealm","nether_a2z1"),Dungeon("Netherrealm","nether_a2z2"),Dungeon("Netherrealm","nether_a3z1"),Dungeon("Netherrealm","nether_a3z2"),Dungeon("The Lost Okwari Caves","ngbearcave"),Dungeon("The Lost Hold","ngdwarfarmory"),Dungeon("Ice Labs","ng_ns_icelabs"),Dungeon("Ice Labs","ng_nw_icelabs"),Dungeon("Ice Labs","ng_se_icelabs"),Dungeon("Ossean Wastes","osseanwastes"),Dungeon("Path of the Honored Dead","pathofhonoreddead"),Dungeon("Phase Beast Realm","phasebeast_a1z1_all"),Dungeon("Phase Beast Realm","phasebeast_a1z2_all"),Dungeon("Phase Beast Realm","phasebeast_a2z1_all"),Dungeon("Phase Beast Realm","phasebeast_a2z2_all"),Dungeon("Phase Beast Realm","phasebeast_a2z2_jt"),Dungeon("Phase Beast Realm","phasebeast_a3z1_all"),Dungeon("Phase Beast Realm","phasebeast_a3z2_all"),Dungeon("Phase Beast Realm","phasebeast_a3z2_lava"),Dungeon("Crystal Protection Challenge","phasegem"),Dungeon("Skeleton Smasher Challenge","phasepillar"),Dungeon("Plunder Cove","piratecove"),Dungeon("Crypt","pvpcrypt"),Dungeon("Dragon","qadragon"),Dungeon("Uber Test Room","qatest"),Dungeon("The Rift Keep","riftkeep"),Dungeon("The Salt Barrens","saltbarrens"),Dungeon("Slavers' Stockade","slaversden"),Dungeon("Swarm Point","swarmpoint"),Dungeon("The Temple Steppes","templesteppes"),Dungeon("Test Room","testroom"),Dungeon("The Forsaken Vaults","theforsakenvaults"),Dungeon("The Bone Gallery","thegardenoftears"),Dungeon("Abandoned Sawmill","thesawmill"),Dungeon("Norsk Leiren","thing"),Dungeon("Tower of the Moon","towerofthemoon"),Dungeon("Estherian Enclave","town1"),Dungeon("Zeryphesh","town2"),Dungeon("Imperial Camp","town3"),Dungeon("The Minehead","town4"),Dungeon("The Undercurrents","undercurrents"),Dungeon("Vault of Souls","vaultofsouls"),Dungeon("The Midnight Quarter","vulturepass"),Dungeon("Watchweald Temple","watchwealdtemple"),Dungeon("Wellspring Temple","watertemple"),Dungeon("The Wellspring Treasury","wellspringtreasury"),Dungeon("The Witherways","witherways")]
    
def scan():#update dungeons manually
  import scanmaps
  path=f'{scanmaps.REFERENCE}/{scanmaps.DIRDUNGEONS}/*.DAT'
  print(f'[{",".join(scanmaps.scan(path))}]')
  raise Exception('Exit')

#scan()
replace=[generate.ReplaceParentDungeon(),generate.ReplaceParentTown(),generate.ReplaceMinMatchLevel(generate.tiers[0]),
         generate.ReplaceMaxMatchLevel(generate.tiers[-1]),ClearLevel()]
for d in dungeons:
  if d.name=='town1':#static file
    continue
  print(d.name+'...')
  generate.modify(f'MEDIA/DUNGEONS/{d.name}.DAT',d.name,replace)
  filename=f'{d.name}.dat'
  os.rename(f'media/dungeons/{filename}',f'media/dungeons/{filename.upper()}')
